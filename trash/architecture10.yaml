architecture:
  version: 0.4
  nodes:
    - !Component # DRAM main memory
      name: DRAM
      class: DRAM
      attributes:
        depth: 24*2**16
        width: 128
        datawidth: 8
        # depth: 134217728
        # width: 128
        # datawidth: 8
      constraints:
        temporal:
          factors: [ E=1]
    - !Container
      name: PE
      spatial: {meshY: 1, meshX: 128}
      constraints:
        spatial:
          factors: [ E=1 ] # [ D=4, L=16, E=1 ]
    - !Component
      name: Buffer
      class: SRAM
      attributes:
        depth: 24*2**16
        width: 128
        datawidth: 8
        # depth: 32768
        # width: 32
        # datawidth: 8
      constraints:
        temporal:
          factors: [ E=768 ] # d_model is 768 -> we partition into 192 parts -> (4,4)(4,16) is 64 * 4 multiply adds -> 192 * 4 = 768
      # constraints:
        # temporal: { factors: [ L=1, D=1, E=1 ], permutation: [ E, L, D ] }
         #temporal: { factors: [ L=1, D=1, E=192 ], permutation: [ E, L, D ] }
    - !Component
      name: Accelerator
      spatial: {meshY: 4, meshX: 16}
      # constraints:
        # temporal: { factors: [ L=1, D=1, E=192 ], permutation: [ E, L, D ] }
        # spatial: { permutation: [ E, L, D ], split: 1 }
      class: intmac
      attributes:
        multiplier_width: 16
        adder_width: 29
